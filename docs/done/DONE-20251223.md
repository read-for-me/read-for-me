# ê°œë°œ ì™„ë£Œ ì´ë ¥ - 2025-12-23

> GeekNews ì›ë³¸ í¬ë¡¤ë§ ê¸°ëŠ¥ ì¶”ê°€, LangChain ê¸°ë°˜ ìš”ì•½ ì„œë¹„ìŠ¤ êµ¬í˜„, Thinking ìŠ¤íŠ¸ë¦¬ë° êµ¬í˜„, **ë‰´ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì„œë¹„ìŠ¤ êµ¬í˜„, í”„ë¡ íŠ¸ì—”ë“œ ë³‘ë ¬ ì²˜ë¦¬ êµ¬í˜„**

---

## Phase 2: í¬ë¡¤ë§ ë° ETL ì•„í‚¤í…ì²˜

### GeekNews ì›ë³¸ ì™¸ë¶€ ë§í¬ í¬ë¡¤ë§ ê¸°ëŠ¥ ì¶”ê°€

- **ê¸°ëŠ¥ ê°œìš”**: GeekNews ì•„í‹°í´ì˜ ì›ë³¸ ì™¸ë¶€ ë§í¬(ì œëª© í•˜ì´í¼ë§í¬)ì˜ ì›¹í˜ì´ì§€ ì½˜í…ì¸ ë„ í•¨ê»˜ í¬ë¡¤ë§
- **í™˜ê²½ë³€ìˆ˜ ì œì–´**: `GEEKNEWS_CRAWL_ORIGINAL=true/false`ë¡œ í™œì„±í™”/ë¹„í™œì„±í™”
- **í…ìŠ¤íŠ¸ ì¶”ì¶œ ë¼ì´ë¸ŒëŸ¬ë¦¬**: `trafilatura` ì‚¬ìš© (ë‹¤ì–‘í•œ ì›¹í˜ì´ì§€ì—ì„œ ì•ˆì •ì ì¸ ë³¸ë¬¸ ì¶”ì¶œ)

**ìˆ˜ì •ëœ íŒŒì¼:**

| íŒŒì¼                                        | ë³€ê²½ ë‚´ìš©                                                         |
| ------------------------------------------- | ----------------------------------------------------------------- |
| `backend/.env`                              | `GEEKNEWS_CRAWL_ORIGINAL=true` í™˜ê²½ë³€ìˆ˜ ì¶”ê°€                      |
| `backend/app/core/config.py`                | `GEEKNEWS_CRAWL_ORIGINAL: bool = False` ì„¤ì • ì¶”ê°€                 |
| `backend/app/services/crawlers/schemas.py`  | `CrawledArticle`, `CleanedArticle`ì— `original_content` í•„ë“œ ì¶”ê°€ |
| `backend/app/services/crawlers/geeknews.py` | ì›ë³¸ í¬ë¡¤ë§ ë¡œì§ ì „ì²´ êµ¬í˜„                                        |
| `backend/pyproject.toml`                    | `trafilatura` ì˜ì¡´ì„± ì¶”ê°€                                         |

**`GeekNewsCrawler` ë³€ê²½ì‚¬í•­:**

- **ìƒˆ ìƒì„±ì íŒŒë¼ë¯¸í„°**: `crawl_original: Optional[bool] = None`
  - `None`: í™˜ê²½ë³€ìˆ˜(`GEEKNEWS_CRAWL_ORIGINAL`)ì—ì„œ ê°’ ë¡œë“œ
  - `True/False`: ëª…ì‹œì ìœ¼ë¡œ í™œì„±í™”/ë¹„í™œì„±í™”
- **ìƒˆ ë©”ì„œë“œ**:
  - `_crawl_original_content(original_url)`: trafilaturaë¡œ ì›ë³¸ ì›¹í˜ì´ì§€ ë³¸ë¬¸ ì¶”ì¶œ
  - `_extract_content_fallback(html)`: trafilatura ì‹¤íŒ¨ ì‹œ CSS ì„ íƒì ê¸°ë°˜ fallback ì¶”ì¶œ
- **`extract()` ë©”ì„œë“œ í™•ì¥**: ì›ë³¸ í¬ë¡¤ë§ ë¡œì§ ì¶”ê°€ (5ë‹¨ê³„ íŒŒì´í”„ë¼ì¸)

**ìŠ¤í‚¤ë§ˆ ë³€ê²½ì‚¬í•­:**

```python
class CrawledArticle(BaseModel):
    # ... ê¸°ì¡´ í•„ë“œ ...
    original_content: str = Field(default="", description="ì›ë³¸ ì™¸ë¶€ ë§í¬ì˜ í¬ë¡¤ë§ëœ ì½˜í…ì¸ ")

class CleanedArticle(BaseModel):
    # ... ê¸°ì¡´ í•„ë“œ ...
    original_content: str = Field(default="", description="ì›ë³¸ ì™¸ë¶€ ë§í¬ì˜ ì •ì œëœ ì½˜í…ì¸ ")
```

**ì‚¬ìš© ì˜ˆì‹œ:**

```python
# í™˜ê²½ë³€ìˆ˜ì—ì„œ ì„¤ì • ë¡œë“œ (ê¸°ë³¸)
crawler = GeekNewsCrawler()

# ëª…ì‹œì  í™œì„±í™”
crawler = GeekNewsCrawler(crawl_original=True)

# ëª…ì‹œì  ë¹„í™œì„±í™”
crawler = GeekNewsCrawler(crawl_original=False)

article = await crawler.extract("https://news.hada.io/topic?id=25115")
print(article.original_content)  # ì›ë³¸ ì›¹í˜ì´ì§€ì˜ ë³¸ë¬¸ í…ìŠ¤íŠ¸
```

**JSON ì €ì¥ ê²°ê³¼ ì˜ˆì‹œ:**

```json
{
  "title": "ì™œ ë‹¹ì‹ ì˜ ìµœê³  ì—”ì§€ë‹ˆì–´ë“¤ì´ ë‹¤ë¥¸ ê³³ì— ë©´ì ‘ì„ ë³´ê³  ìˆì„ê¹Œ",
  "content": "ğŸ”— Original: https://codegood.co/...\nğŸ“Š points: 121...",
  "original_content": "ì›ë³¸ ì›¹í˜ì´ì§€ì—ì„œ ì¶”ì¶œëœ ì „ì²´ ë³¸ë¬¸ í…ìŠ¤íŠ¸...",
  "metadata": {
    "original_url": "https://codegood.co/writing/...",
    "topic_id": "25115"
  }
}
```

**ë™ì‘ íë¦„:**

```
[POST /api/v1/crawl?url=news.hada.io/topic?id=25115]
       â”‚
       â–¼
[GeekNewsCrawler.extract()]
       â”‚
       â”œâ”€> GeekNews ì•„í‹°í´ í¬ë¡¤ë§ (ê¸°ì¡´ ë¡œì§)
       â”‚
       â”œâ”€> crawl_original == True?
       â”‚         â”‚
       â”‚         â”œâ”€ Yes â”€> _crawl_original_content(ì›ë³¸URL)
       â”‚         â”‚              â””â”€> trafilaturaë¡œ ë³¸ë¬¸ ì¶”ì¶œ
       â”‚         â”‚              â””â”€> ì‹¤íŒ¨ ì‹œ fallback ì¶”ì¶œ
       â”‚         â”‚              â””â”€> original_contentì— ì €ì¥
       â”‚         â”‚
       â”‚         â””â”€ No â”€> original_content = ""
       â”‚
       â–¼
[CrawledArticle ë°˜í™˜ (original_content í¬í•¨)]
```

---

## Phase 3: AI ì„œë¹„ìŠ¤ êµ¬í˜„

### ìš”ì•½ ì„œë¹„ìŠ¤ êµ¬í˜„ (Phase 3-1 ì™„ë£Œ)

- [x] **LangChain ê¸°ë°˜ ìš”ì•½ ì„œë¹„ìŠ¤ êµ¬í˜„**
  - [x] `langchain-google-genai` ì˜ì¡´ì„± ì¶”ê°€ (`pyproject.toml`)
  - [x] `output_schemas/` ë””ë ‰í† ë¦¬ ë° `SummaryResult` ìŠ¤í‚¤ë§ˆ ìƒì„±
  - [x] `prompts/v1/summary.md` í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ìƒì„±
  - [x] `app/services/prompt_loader.py` í”„ë¡¬í”„íŠ¸ ë¡œë” êµ¬í˜„
  - [x] `app/services/summary.py` SummaryService êµ¬í˜„
  - [x] `app/api/v1/summarize.py` API ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
  - [x] `main.py`ì— summarize ë¼ìš°í„° ë“±ë¡

**ìˆ˜ì •/ìƒì„±ëœ íŒŒì¼:**

| íŒŒì¼                                    | ë³€ê²½ ë‚´ìš©                                              |
| --------------------------------------- | ------------------------------------------------------ |
| `backend/pyproject.toml`                | `langchain-google-genai>=2.1.0` ì˜ì¡´ì„± ì¶”ê°€            |
| `backend/output_schemas/__init__.py`    | ì¶œë ¥ ìŠ¤í‚¤ë§ˆ íŒ¨í‚¤ì§€ ì´ˆê¸°í™”                              |
| `backend/output_schemas/summary.py`     | `SummaryResult` Pydantic ìŠ¤í‚¤ë§ˆ (Structured Outputìš©)  |
| `backend/prompts/v1/summary.md`         | ìš”ì•½ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ (ë²„ì „ ê´€ë¦¬ ê°€ëŠ¥)                  |
| `backend/app/services/prompt_loader.py` | ë§ˆí¬ë‹¤ìš´ í”„ë¡¬í”„íŠ¸ ë¡œë” ìœ í‹¸ë¦¬í‹°                        |
| `backend/app/services/summary.py`       | `SummaryService` í´ë˜ìŠ¤ (LangChain + Vertex AI ë°±ì—”ë“œ) |
| `backend/app/api/v1/summarize.py`       | `POST /api/v1/summarize` ì—”ë“œí¬ì¸íŠ¸                    |
| `backend/app/main.py`                   | summarize ë¼ìš°í„° ë“±ë¡                                  |

**ë””ë ‰í† ë¦¬ êµ¬ì¡° (Phase 3 ì¶”ê°€ë¶„):**

```
backend/
â”œâ”€â”€ prompts/
â”‚   â””â”€â”€ v1/
â”‚       â””â”€â”€ summary.md              # ìš”ì•½ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
â”œâ”€â”€ output_schemas/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ summary.py                  # SummaryResult Pydantic ìŠ¤í‚¤ë§ˆ
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ prompt_loader.py        # í”„ë¡¬í”„íŠ¸ ë¡œë” ìœ í‹¸ë¦¬í‹°
â”‚   â”‚   â””â”€â”€ summary.py              # SummaryService êµ¬í˜„
â”‚   â””â”€â”€ api/v1/
â”‚       â””â”€â”€ summarize.py            # POST /api/v1/summarize ì—”ë“œí¬ì¸íŠ¸
â””â”€â”€ pyproject.toml                  # langchain-google-genai ì˜ì¡´ì„± ì¶”ê°€ë¨
```

**SummaryService ì£¼ìš” íŠ¹ì§•:**

- **LangChain í™œìš©**: `ChatGoogleGenerativeAI` + `with_structured_output()` ì‚¬ìš©
- **ADC ì¸ì¦**: ì„œë¹„ìŠ¤ ê³„ì • í‚¤ íŒŒì¼(`~/readforme-key.json`) ìë™ ê°ì§€
- **Vertex AI ë°±ì—”ë“œ**: `credentials`, `project` íŒŒë¼ë¯¸í„° ì œê³µ ì‹œ ìë™ ì„ íƒ
- **Structured Output**: `SummaryResult` Pydantic ëª¨ë¸ë¡œ íƒ€ì… ì•ˆì „í•œ ì¶œë ¥
- **í”„ë¡¬í”„íŠ¸ ë²„ì „ ê´€ë¦¬**: `prompts/v1/summary.md` íŒŒì¼ë¡œ ë¶„ë¦¬í•˜ì—¬ A/B í…ŒìŠ¤íŠ¸ ìš©ì´

**SummaryResult ìŠ¤í‚¤ë§ˆ:**

```python
class SummaryResult(BaseModel):
    bullet_points: list[str] = Field(
        ..., min_length=3, max_length=5,
        description="í•µì‹¬ í¬ì¸íŠ¸ ìš”ì•½ (3-5ê°œì˜ ë¶ˆë¦¿ í¬ì¸íŠ¸)"
    )
    main_topic: str = Field(
        ..., description="ê¸€ì˜ ì£¼ìš” ì£¼ì œë¥¼ í•œ ì¤„ë¡œ ìš”ì•½"
    )
```

**API ì—”ë“œí¬ì¸íŠ¸:**

```bash
# ìš”ì•½ API
POST /api/v1/summarize
{
  "content": "ìš”ì•½í•  ì½˜í…ì¸ ...",
  "url": "https://..." # ì„ íƒ (ìºì‹±ìš©)
}

# ì‘ë‹µ
{
  "bullet_points": ["í¬ì¸íŠ¸ 1", "í¬ì¸íŠ¸ 2", "í¬ì¸íŠ¸ 3"],
  "main_topic": "ì£¼ìš” ì£¼ì œ í•œ ì¤„ ìš”ì•½",
  "model": "gemini-2.5-flash",
  "processing_time_ms": 1234
}
```

**ì‚¬ìš© ì˜ˆì‹œ:**

```python
from app.services.summary import get_summary_service

service = get_summary_service()
result = await service.summarize("ìš”ì•½í•  ì½˜í…ì¸ ...")

print(result.bullet_points)  # ['í¬ì¸íŠ¸1', 'í¬ì¸íŠ¸2', 'í¬ì¸íŠ¸3']
print(result.main_topic)     # 'ì£¼ìš” ì£¼ì œ ìš”ì•½'
```

**âš ï¸ ì„ í–‰ ìš”êµ¬ì‚¬í•­:**

Vertex AI APIê°€ Google Cloud í”„ë¡œì íŠ¸ì—ì„œ í™œì„±í™”ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:
ğŸ‘‰ https://console.developers.google.com/apis/api/aiplatform.googleapis.com/overview?project=gen-lang-client-0039052673

---

### Hydration ì—ëŸ¬ ìˆ˜ì • ë° ì½˜í…ì¸  ë¯¸ë¦¬ë³´ê¸° ê°œì„ 

- [x] **Hydration ì—ëŸ¬ ìˆ¨ê¸°ê¸°**

  - ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨(Liner ë“±)ì´ `<html>`, `<body>` íƒœê·¸ì— ì†ì„±ì„ ì£¼ì…í•˜ì—¬ ë°œìƒí•˜ëŠ” hydration mismatch ê²½ê³  í•´ê²°
  - `layout.tsx`ì— `suppressHydrationWarning` ì†ì„± ì¶”ê°€

- [x] **í¬ë¡¤ëŸ¬ ì½˜í…ì¸  ì •ì œ ê°œì„ **

  - `geeknews.py`ì˜ `_build_content()` ë©”ì„œë“œì—ì„œ ë©”íƒ€ë°ì´í„° ì¤‘ë³µ ì œê±°
  - `cleaned_content`ì— ìˆœìˆ˜ ë³¸ë¬¸ë§Œ ì €ì¥ (ë©”íƒ€ë°ì´í„°ëŠ” `metadata` í•„ë“œì— ë³„ë„ ì €ì¥ë¨)
  - ëŒ“ê¸€ í˜•ì‹ ë§ˆí¬ë‹¤ìš´ ìŠ¤íƒ€ì¼ë¡œ ê°œì„  (`## ëŒ“ê¸€ (Nê°œ)`, `**ì‘ì„±ì**`)

- [x] **í”„ë¡ íŠ¸ì—”ë“œ ë¯¸ë¦¬ë³´ê¸° í…ìŠ¤íŠ¸ ê°œì„ **
  - `source-panel.tsx`ì—ì„œ `og_description` ìš°ì„  ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½
  - ìš°ì„ ìˆœìœ„: `og_description` â†’ `preview_text` â†’ `cleaned_content.slice(0, 300)`

**ìˆ˜ì •ëœ íŒŒì¼:**

| íŒŒì¼                                        | ë³€ê²½ ë‚´ìš©                                                  |
| ------------------------------------------- | ---------------------------------------------------------- |
| `frontend/app/layout.tsx`                   | `<html>`, `<body>`ì— `suppressHydrationWarning` ì†ì„± ì¶”ê°€  |
| `backend/app/services/crawlers/geeknews.py` | `_build_content()` ë©”ì„œë“œì—ì„œ ë©”íƒ€ë°ì´í„° ì œê±°, ë³¸ë¬¸ë§Œ ë°˜í™˜ |
| `frontend/components/source-panel.tsx`      | ë¯¸ë¦¬ë³´ê¸° í…ìŠ¤íŠ¸ì— `og_description` ìš°ì„  ì‚¬ìš©               |

**ë³€ê²½ ì „ (`_build_content` ì¶œë ¥):**

```
ğŸ”— Original: https://...
ğŸ“Š points: 122 | author: neo | published_time: 2025-12-16 11:06
ğŸ“ Content
----------------------------------------
â€¢ ë³¸ë¬¸ ë‚´ìš©...
```

**ë³€ê²½ í›„ (`_build_content` ì¶œë ¥):**

```
â€¢ ë³¸ë¬¸ ë‚´ìš©...

## ëŒ“ê¸€ (Nê°œ)

**ì‘ì„±ì** (ì‹œê°„)
ëŒ“ê¸€ ë‚´ìš©...
```

**ì°¸ê³ ì‚¬í•­:**

- ê¸°ì¡´ í¬ë¡¤ë§ëœ JSON íŒŒì¼ì€ ì´ì „ í˜•ì‹ ìœ ì§€ (ìƒˆë¡œ í¬ë¡¤ë§í•˜ëŠ” ì½˜í…ì¸ ë¶€í„° ì ìš©)
- Hydration ê²½ê³ ëŠ” ê¸°ëŠ¥ì— ì˜í–¥ ì—†ìŒ (ê°œë°œ ëª¨ë“œ ê²½ê³ ë§Œ ìˆ¨ê¹€)

---

### GeekNews original_content ìš”ì•½ í†µí•©

- [x] **GeekNews ì›ë³¸ ì™¸ë¶€ ë§í¬ ì½˜í…ì¸ ë¥¼ ìš”ì•½ì— í†µí•©**
  - GeekNews ì•„í‹°í´ì˜ `cleaned_content`(ì›¹í˜ì´ì§€ ë³¸ë¬¸)ì™€ `original_content`(ì›ë³¸ ì™¸ë¶€ ë§í¬ ì½˜í…ì¸ )ë¥¼ ë³‘í•©í•˜ì—¬ ìš”ì•½
  - ë°±ì—”ë“œì—ì„œ ë³‘í•© ì²˜ë¦¬, í”„ë¡¬í”„íŠ¸ì—ì„œ ë‘ ì†ŒìŠ¤ êµ¬ë¶„ í‘œì‹œ

**ìˆ˜ì •ëœ íŒŒì¼:**

| íŒŒì¼                              | ë³€ê²½ ë‚´ìš©                                                    |
| --------------------------------- | ------------------------------------------------------------ |
| `backend/app/api/v1/summarize.py` | `SummarizeRequest`ì— `original_content` í•„ë“œ ì¶”ê°€            |
| `backend/app/services/summary.py` | `_merge_content()` ë©”ì„œë“œ ì¶”ê°€, `summarize()` íŒŒë¼ë¯¸í„° í™•ì¥  |
| `backend/prompts/v1/summary.md`   | ë‘ ì†ŒìŠ¤ ì¢…í•© ìš”ì•½ ì§€ì¹¨ ì¶”ê°€                                  |
| `frontend/lib/api.ts`             | `SummarizeRequest` ì¸í„°í˜ì´ìŠ¤ì— `original_content` í•„ë“œ ì¶”ê°€ |
| `frontend/app/page.tsx`           | `summarizeContent()` í˜¸ì¶œ ì‹œ `original_content` í¬í•¨         |

**ì½˜í…ì¸  ë³‘í•© ë¡œì§:**

```python
# backend/app/services/summary.py
def _merge_content(
    self,
    content: str,
    original_content: str | None = None,
) -> str:
    if not original_content or not original_content.strip():
        return content

    merged = f"""## GeekNews ìš”ì•½/ì½”ë©˜íŠ¸

{content.strip()}

## ì›ë³¸ ì•„í‹°í´

{original_content.strip()}"""

    return merged
```

**í”„ë¡¬í”„íŠ¸ ë³€ê²½ (summary.md):**

```markdown
## ì£¼ì˜ì‚¬í•­

...

- ê¸€ì— "GeekNews ìš”ì•½/ì½”ë©˜íŠ¸"ì™€ "ì›ë³¸ ì•„í‹°í´" ë‘ ì„¹ì…˜ì´ ìˆëŠ” ê²½ìš°:
  - ë‘ ì†ŒìŠ¤ë¥¼ ì¢…í•©í•˜ì—¬ ìš”ì•½í•´ì£¼ì„¸ìš”.
  - ì›ë³¸ ì•„í‹°í´ì˜ í•µì‹¬ ë‚´ìš©ì— ë” ë¹„ì¤‘ì„ ë‘ë˜, GeekNews ì½”ë©˜íŠ¸ì˜ ì¸ì‚¬ì´íŠ¸ë„ ë°˜ì˜í•´ì£¼ì„¸ìš”.
```

**ë™ì‘ íë¦„:**

```
[í”„ë¡ íŠ¸ì—”ë“œ]
  page.tsx: summarizeContent({
    content: crawled.cleaned_content,
    original_content: crawled.original_content,  // ì¶”ê°€ë¨
    ...
  })
       â”‚
       â–¼
[ë°±ì—”ë“œ API]
  SummarizeRequest.original_content (Optional)
       â”‚
       â–¼
[SummaryService]
  _merge_content() â†’ ë‘ ì†ŒìŠ¤ ë³‘í•©
       â”‚
       â–¼
[LLM í”„ë¡¬í”„íŠ¸]
  ## GeekNews ìš”ì•½/ì½”ë©˜íŠ¸
  {cleaned_content}

  ## ì›ë³¸ ì•„í‹°í´
  {original_content}
       â”‚
       â–¼
[ìš”ì•½ ê²°ê³¼]
```

**í•˜ìœ„ í˜¸í™˜ì„±:**

- `original_content`ëŠ” Optional í•„ë“œì´ë¯€ë¡œ ê¸°ì¡´ API í˜¸ì¶œê³¼ ì™„ë²½ í˜¸í™˜
- Medium ë“± `original_content`ê°€ ì—†ëŠ” í”Œë«í¼ì€ ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ë™ì‘

---

### Thinking (AI ì¶”ë¡  ê³¼ì •) ìŠ¤íŠ¸ë¦¬ë° êµ¬í˜„

- [x] **Gemini Thinking ê¸°ëŠ¥ êµ¬í˜„ ë° í™˜ê²½ì„¤ì • ì—°ë™**
  - LangChain `ChatGoogleGenerativeAI`ì˜ `thinking_budget`, `include_thoughts` íŒŒë¼ë¯¸í„° í™œìš©
  - `.env` íŒŒì¼ì—ì„œ `GEMINI_THINKING_LEVEL`, `GEMINI_THINKING_BUDGET` í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì • ê´€ë¦¬
  - `config.py` Settings í´ë˜ìŠ¤ì— Thinking ê´€ë ¨ í•„ë“œ ì¶”ê°€
  - Frontend `InsightCard` ì»´í¬ë„ŒíŠ¸ì—ì„œ Thinking ì„¹ì…˜ UI (Collapsible) í‘œì‹œ

**ìˆ˜ì •ëœ íŒŒì¼:**

| íŒŒì¼                              | ë³€ê²½ ë‚´ìš©                                                        |
| --------------------------------- | ---------------------------------------------------------------- |
| `backend/.env`                    | `GEMINI_THINKING_LEVEL=low`, `GEMINI_THINKING_BUDGET=2048` ì¶”ê°€  |
| `backend/app/core/config.py`      | Settings í´ë˜ìŠ¤ì— `GEMINI_THINKING_LEVEL`, `GEMINI_THINKING_BUDGET` í•„ë“œ ì¶”ê°€ |
| `backend/app/services/summary.py` | `llm_streaming` ìƒì„± ì‹œ `thinking_budget`, `include_thoughts=True` ì ìš© |

**í•µì‹¬ êµ¬í˜„ ì½”ë“œ:**

```python
# backend/app/services/summary.py
self.llm_streaming = ChatGoogleGenerativeAI(
    model=model_name,
    credentials=credentials,
    project=self.project_id,
    temperature=0.3,
    thinking_budget=self.thinking_budget,  # Thinking í† í° ì˜ˆì‚°
    include_thoughts=True,  # Thinking ë¸”ë¡ í¬í•¨ (í•„ìˆ˜!)
)
```

**í™˜ê²½ë³€ìˆ˜ ì„¤ì •:**

```env
# backend/.env
# Gemini Thinking ì„¤ì •
GEMINI_THINKING_LEVEL=low    # "low", "medium", "high" ë˜ëŠ” "off"
GEMINI_THINKING_BUDGET=2048  # Thinking í† í° ì˜ˆì‚°
```

**Config ì„¤ì •:**

```python
# backend/app/core/config.py
class Settings(BaseSettings):
    # Gemini Thinking ì„¤ì •
    GEMINI_THINKING_LEVEL: str = "low"
    GEMINI_THINKING_BUDGET: int = 2048
```

**ë™ì‘ íë¦„:**

```
[.env íŒŒì¼]
  GEMINI_THINKING_LEVEL=low
  GEMINI_THINKING_BUDGET=2048
       â”‚
       â–¼
[config.py Settings]
  - GEMINI_THINKING_LEVEL
  - GEMINI_THINKING_BUDGET
       â”‚
       â–¼
[SummaryService.__init__()]
  - settingsì—ì„œ ê°’ ë¡œë“œ
  - thinking_level == "off"ì´ë©´ thinking_budget = 0
       â”‚
       â–¼
[ChatGoogleGenerativeAI]
  - thinking_budget=2048
  - include_thoughts=True  â† í•µì‹¬!
       â”‚
       â–¼
[ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ]
  - chunk.contentê°€ list í˜•íƒœ
  - [{"type": "thinking", "thinking": "..."}, {"type": "text", "text": "..."}]
       â”‚
       â–¼
[SSE ì´ë²¤íŠ¸]
  - event: thinking
  - event: content
       â”‚
       â–¼
[Frontend InsightCard]
  - Thinking ì„¹ì…˜ (Collapsible)
  - ìš”ì•½ ê²°ê³¼ í‘œì‹œ
```

**ì£¼ì˜ì‚¬í•­:**

- `thinking_budget`ë§Œ ì„¤ì •í•˜ë©´ thinkingì´ í™œì„±í™”ë˜ì§€ ì•ŠìŒ
- **ë°˜ë“œì‹œ `include_thoughts=True`ë¥¼ í•¨ê»˜ ì„¤ì •í•´ì•¼ thinking ë¸”ë¡ì´ ì‘ë‹µì— í¬í•¨ë¨**
- LangChain ë¬¸ì„œ: "To see a thinking model's reasoning, set include_thoughts=True"

---

### ë‰´ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì„œë¹„ìŠ¤ êµ¬í˜„ (Phase 3-2)

- [x] **AudioService í™˜ê²½ë³€ìˆ˜ ì„¤ì •**
  - [x] `config.py`ì— `AUDIO_SCRIPT_*` ì „ìš© ì„¤ì • ì¶”ê°€ (SummaryServiceì™€ ë…ë¦½)
- [x] **NewsScript Pydantic ìŠ¤í‚¤ë§ˆ ìƒì„±**
  - [x] `output_schemas/audio.py` íŒŒì¼ ìƒì„±
- [x] **ë‰´ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ìƒì„±**
  - [x] `prompts/v1/news_script.md` íŒŒì¼ ìƒì„±
- [x] **AudioService í´ë˜ìŠ¤ êµ¬í˜„**
  - [x] LangChain `ChatGoogleGenerativeAI` + `with_structured_output()` í™œìš©
  - [x] ì½˜í…ì¸  ë³‘í•© ë¡œì§ (cleaned_content + original_content)
  - [x] `tenacity` ê¸°ë°˜ ì¬ì‹œë„ ë¡œì§ ì ìš©
- [x] **API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„**
  - [x] `POST /api/v1/audio/script` ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
  - [x] ìŠ¤í¬ë¦½íŠ¸ ê²°ê³¼ JSON ì €ì¥ ê¸°ëŠ¥
- [x] **ë¼ìš°í„° ë“±ë¡**
  - [x] `main.py`ì— audio ë¼ìš°í„° ë“±ë¡
  - [x] `app/api/v1/__init__.py`ì— audio ëª¨ë“ˆ export ì¶”ê°€

**ìˆ˜ì •/ìƒì„±ëœ íŒŒì¼:**

| íŒŒì¼                                 | ë³€ê²½ ë‚´ìš©                                                     |
| ------------------------------------ | ------------------------------------------------------------- |
| `backend/app/core/config.py`         | `AUDIO_SCRIPT_*` í™˜ê²½ë³€ìˆ˜ ì„¤ì • ì¶”ê°€                           |
| `backend/output_schemas/audio.py`    | `NewsScript` Pydantic ìŠ¤í‚¤ë§ˆ ìƒì„± (Structured Outputìš©)       |
| `backend/prompts/v1/news_script.md`  | 3ë¶„ ë‰´ìŠ¤ ë¦¬í¬íŒ… ëŒ€ë³¸ ìƒì„± í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿                     |
| `backend/app/services/audio.py`      | `AudioService` í´ë˜ìŠ¤ êµ¬í˜„ (LangChain + Vertex AI)            |
| `backend/app/api/v1/audio.py`        | `POST /api/v1/audio/script` ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„                   |
| `backend/app/api/v1/__init__.py`     | `audio` ëª¨ë“ˆ export ì¶”ê°€                                      |
| `backend/app/main.py`                | `audio.router` ë“±ë¡                                           |

**AudioService ì£¼ìš” íŠ¹ì§•:**

- **ë…ë¦½ì  LLM ì„¤ì •**: SummaryServiceì™€ ë¶„ë¦¬ëœ `AUDIO_SCRIPT_*` í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©
- **Structured Output**: `NewsScript` Pydantic ëª¨ë¸ë¡œ íƒ€ì… ì•ˆì „í•œ ì¶œë ¥
- **ì½˜í…ì¸  ë³‘í•©**: GeekNewsì˜ `original_content` í¬í•¨ ì‹œ ë‘ ì†ŒìŠ¤ ë³‘í•©
- **ì¬ì‹œë„ ë¡œì§**: `tenacity`ë¥¼ ì‚¬ìš©í•œ 3íšŒ ì¬ì‹œë„ (ì§€ìˆ˜ ë°±ì˜¤í”„)

**NewsScript ìŠ¤í‚¤ë§ˆ:**

```python
class NewsScript(BaseModel):
    """ë‰´ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ê²°ê³¼ ìŠ¤í‚¤ë§ˆ - LLM Structured Outputìš©"""

    paragraphs: list[str] = Field(
        ..., min_length=8, max_length=12,
        description="ë¬¸ë‹¨ë³„ ìŠ¤í¬ë¦½íŠ¸ (8~12ê°œ, TTS ì²­í‚¹ìš©)",
    )
    title: str = Field(
        ..., min_length=20, max_length=40,
        description="ë‰´ìŠ¤ í—¤ë“œë¼ì¸ (20~40ì)",
    )
    estimated_duration_sec: int = Field(
        ..., ge=170, le=190,
        description="ì˜ˆìƒ ë¶„ëŸ‰ (ì´ˆ, 170~190ì´ˆ)",
    )
    total_characters: int = Field(
        ..., ge=900, le=1050,
        description="ì´ ê¸€ì ìˆ˜ (900~1050ì)",
    )
```

**í™˜ê²½ë³€ìˆ˜ ì„¤ì •:**

```env
# AudioService (ë‰´ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±) ì „ìš© ì„¤ì •
AUDIO_SCRIPT_MODEL=gemini-2.5-flash
AUDIO_SCRIPT_THINKING_LEVEL=low
AUDIO_SCRIPT_THINKING_BUDGET=2048
AUDIO_SCRIPT_INCLUDE_THOUGHTS=false
AUDIO_SCRIPT_TEMPERATURE=0.5
```

**API ì—”ë“œí¬ì¸íŠ¸:**

```bash
# ë‰´ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± API
POST /api/v1/audio/script
{
  "content": "í¬ë¡¤ë§ëœ ì½˜í…ì¸ ...",
  "original_content": "ì›ë³¸ ì™¸ë¶€ ë§í¬ ì½˜í…ì¸ ...",  # Optional
  "url": "https://...",
  "article_id": "topic_25115",
  "user_id": "default"  # Optional
}

# ì‘ë‹µ
{
  "user_id": "default",
  "article_id": "topic_25115",
  "script": {
    "paragraphs": ["ì²« ë²ˆì§¸ ë¬¸ë‹¨...", "ë‘ ë²ˆì§¸ ë¬¸ë‹¨...", ...],
    "title": "ë‰´ìŠ¤ í—¤ë“œë¼ì¸ ì œëª©",
    "estimated_duration_sec": 180,
    "total_characters": 950
  },
  "model": "gemini-2.5-flash",
  "processing_time_ms": 2345,
  "saved_path": "data/users/default/audio/topic_25115_2025-12-23T23-19-07.json"
}
```

**ì‚¬ìš© ì˜ˆì‹œ:**

```python
from app.services.audio import get_audio_service

service = get_audio_service()
result = await service.generate_script(
    content="í¬ë¡¤ë§ëœ ì½˜í…ì¸ ...",
    original_content="ì›ë³¸ ì™¸ë¶€ ë§í¬ ì½˜í…ì¸ ...",
)

print(result.title)        # 'ë‰´ìŠ¤ í—¤ë“œë¼ì¸ ì œëª©'
print(result.paragraphs)   # ['ì²« ë²ˆì§¸ ë¬¸ë‹¨...', 'ë‘ ë²ˆì§¸ ë¬¸ë‹¨...', ...]
print(result.estimated_duration_sec)  # 180
```

**ë²„ê·¸ ìˆ˜ì • - KeyError í•´ê²°:**

í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ë‚´ JSON ì˜ˆì‹œì˜ ì¤‘ê´„í˜¸ `{}`ê°€ Python `str.format()`ì— ì˜í•´ ë³€ìˆ˜ë¡œ í•´ì„ë˜ì–´ `KeyError: '\n  "paragraphs"'` ë°œìƒ.

í•´ê²°: `news_script.md` ë‚´ ëª¨ë“  JSON ì¤‘ê´„í˜¸ë¥¼ `{{}}` í˜•íƒœë¡œ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬

```markdown
# ë³€ê²½ ì „ (ì—ëŸ¬ ë°œìƒ)
```json
{
  "paragraphs": ["..."],
  ...
}
```

# ë³€ê²½ í›„ (ì •ìƒ ë™ì‘)
```json
{{
  "paragraphs": ["..."],
  ...
}}
```

---

### í”„ë¡ íŠ¸ì—”ë“œ ë³‘ë ¬ ì²˜ë¦¬ êµ¬í˜„ (Phase 3-2)

- [x] **API í•¨ìˆ˜ ì¶”ê°€**
  - [x] `frontend/lib/api.ts`ì— `NewsScript`, `GenerateScriptResponse` ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€
  - [x] `generateScript()` ë¹„ë™ê¸° í•¨ìˆ˜ ì¶”ê°€
- [x] **ë³‘ë ¬ ì²˜ë¦¬ ë¡œì§ êµ¬í˜„**
  - [x] `page.tsx`ì—ì„œ í¬ë¡¤ë§ í›„ `Promise.all()`ë¡œ ìš”ì•½/ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ë³‘ë ¬ ì‹¤í–‰
  - [x] `scriptData` ìƒíƒœ ë³€ìˆ˜ ì¶”ê°€
  - [x] `ProcessingStatus` íƒ€ì…ì— `"scripting"` ìƒíƒœ ì¶”ê°€
- [x] **ì»´í¬ë„ŒíŠ¸ Props ì—…ë°ì´íŠ¸**
  - [x] `ContentPanel`ì— `scriptData` prop ì¶”ê°€
  - [x] `IntelligencePanel`ì— `scriptData` prop ì¶”ê°€
  - [x] `AudioPlayerCard`ì— `isScripting`, `scriptData`, `error` props ì¶”ê°€
- [x] **AudioPlayerCard UI ì—…ë°ì´íŠ¸**
  - [x] ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì¤‘ ë¡œë”© ìƒíƒœ í‘œì‹œ
  - [x] ìŠ¤í¬ë¦½íŠ¸ ì œëª©, ì˜ˆìƒ ì‹œê°„, ì´ ê¸€ì ìˆ˜, ë¬¸ë‹¨ ìˆ˜ í‘œì‹œ

**ìˆ˜ì •ëœ íŒŒì¼:**

| íŒŒì¼                                      | ë³€ê²½ ë‚´ìš©                                               |
| ----------------------------------------- | ------------------------------------------------------- |
| `frontend/lib/api.ts`                     | `NewsScript`, `GenerateScriptResponse` ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€  |
| `frontend/lib/api.ts`                     | `generateScript()` í•¨ìˆ˜ ì¶”ê°€                            |
| `frontend/app/page.tsx`                   | `Promise.all()` ë³‘ë ¬ ì²˜ë¦¬, `scriptData` ìƒíƒœ ì¶”ê°€       |
| `frontend/components/content-panel.tsx`   | `scriptData` prop ì¶”ê°€ ë° í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë¡œ ì „ë‹¬          |
| `frontend/components/intelligence-panel.tsx` | `scriptData` prop ì¶”ê°€ ë° `AudioPlayerCard`ë¡œ ì „ë‹¬   |
| `frontend/components/audio-player-card.tsx`  | ìŠ¤í¬ë¦½íŠ¸ ì •ë³´ í‘œì‹œ UI, ë¡œë”© ìƒíƒœ ì²˜ë¦¬                |

**ë™ì‘ íë¦„:**

```
[ì‚¬ìš©ì URL ì…ë ¥]
       â”‚
       â–¼
[Step 1: í¬ë¡¤ë§]
  POST /api/v1/crawl
       â”‚
       â”œâ”€ ì„±ê³µ â†’ CrawlResponse ì €ì¥
       â””â”€ ì‹¤íŒ¨ â†’ ì—ëŸ¬ í‘œì‹œ, ì¤‘ë‹¨
       â”‚
       â–¼
[Step 2: ë³‘ë ¬ ì²˜ë¦¬ (Promise.all)]
       â”‚
       â”œâ”€> [ìš”ì•½ ìŠ¤íŠ¸ë¦¬ë°]
       â”‚     POST /api/v1/summarize/stream
       â”‚     - SSEë¡œ thinking/content ìŠ¤íŠ¸ë¦¬ë°
       â”‚     - InsightCardì— ì‹¤ì‹œê°„ í‘œì‹œ
       â”‚
       â””â”€> [ìŠ¤í¬ë¦½íŠ¸ ìƒì„±]
             POST /api/v1/audio/script
             - ë‹¨ì¼ ì‘ë‹µ (ë¹„ìŠ¤íŠ¸ë¦¬ë°)
             - AudioPlayerCardì— í‘œì‹œ
       â”‚
       â–¼
[Step 3: ì™„ë£Œ]
  - status = "done"
  - ìš”ì•½ ê²°ê³¼ + ìŠ¤í¬ë¦½íŠ¸ ê²°ê³¼ ëª¨ë‘ í‘œì‹œ
```

**í”„ë¡ íŠ¸ì—”ë“œ ìƒíƒœ ê´€ë¦¬:**

```typescript
// ProcessingStatus íƒ€ì… í™•ì¥
type ProcessingStatus = "idle" | "crawling" | "summarizing" | "scripting" | "done" | "error";

// ErrorInfo.stage íƒ€ì… í™•ì¥
interface ErrorInfo {
  stage: "crawl" | "summarize" | "script";
  message: string;
}

// ìƒˆë¡œìš´ ìƒíƒœ ë³€ìˆ˜
const [scriptData, setScriptData] = useState<GenerateScriptResponse | null>(null);
```

**ë³‘ë ¬ ì²˜ë¦¬ ì½”ë“œ:**

```typescript
// page.tsx - Promise.allë¡œ ë³‘ë ¬ ì²˜ë¦¬
const [summaryResult, scriptResult] = await Promise.all([
  // ìš”ì•½ ìŠ¤íŠ¸ë¦¬ë° (Promiseë¡œ ë˜í•‘)
  new Promise<SummarizeResponse>((resolve, reject) => {
    summarizeStreamWithCallbacks(
      { content, original_content, url, article_id },
      {
        onThinking: (text) => setStreaming(prev => ({ ...prev, thinkingContent: text })),
        onContent: (text) => setStreaming(prev => ({ ...prev, mainContent: text })),
        onDone: (result) => resolve(result),
        onError: (msg) => reject(new Error(msg)),
      }
    );
  }),
  
  // ìŠ¤í¬ë¦½íŠ¸ ìƒì„± (ì¼ë°˜ async/await)
  generateScript({ content, original_content, url, article_id }),
]);
```

**AudioPlayerCard UI ë³€ê²½:**

```
[ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì „]
  - ì»´í¬ë„ŒíŠ¸ ìˆ¨ê¹€ (null ë°˜í™˜)

[ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì¤‘ (isScripting=true)]
  - "ë¦¬í¬íŒ… ëŒ€ë³¸ ì‘ì„± ì¤‘..." ë©”ì‹œì§€
  - Skeleton ë¡œë”© ì• ë‹ˆë©”ì´ì…˜

[ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì™„ë£Œ (scriptData ì¡´ì¬)]
  - ì œëª©: "ë‰´ìŠ¤ í—¤ë“œë¼ì¸ ì œëª©"
  - ë©”íƒ€ ì •ë³´: "03:00 â€¢ 950ì â€¢ 10ë¬¸ë‹¨"
  - ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ì»¨íŠ¸ë¡¤ (TTS ë¯¸êµ¬í˜„ìœ¼ë¡œ ë¹„í™œì„±í™”)
```

---

## ì„¤ê³„ ê²°ì • ê¸°ë¡ (ADR)

### ADR-011: í”„ë¡ íŠ¸ì—”ë“œ ë³‘ë ¬ ì²˜ë¦¬ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ì„ íƒ

| í•­ëª©       | ë‚´ìš©                                                                                                                                                                   |
| ---------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **ê²°ì •**   | í”„ë¡ íŠ¸ì—”ë“œì—ì„œ `Promise.all()`ì„ ì‚¬ìš©í•˜ì—¬ ìš”ì•½/ìŠ¤í¬ë¦½íŠ¸ ìƒì„± APIë¥¼ ë³‘ë ¬ í˜¸ì¶œ                                                                                           |
| **ì´ìœ **   | 1. ë°±ì—”ë“œ ë³€ê²½ ìµœì†Œí™” <br> 2. í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ê° API ìƒíƒœ ë…ë¦½ ê´€ë¦¬ ê°€ëŠ¥ <br> 3. ì—ëŸ¬ ë°œìƒ ì‹œ ë¶€ë¶„ ì„±ê³µ/ì‹¤íŒ¨ ì²˜ë¦¬ ìš©ì´ <br> 4. ê¸°ì¡´ SSE ìŠ¤íŠ¸ë¦¬ë° ì•„í‚¤í…ì²˜ ìœ ì§€          |
| **ëŒ€ì•ˆ**   | ë°±ì—”ë“œ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ - ë‹¨ì¼ APIì—ì„œ ë³‘ë ¬ ì²˜ë¦¬ í›„ ê²°ê³¼ ë°˜í™˜. ê¸°ì¡´ SSE ìŠ¤íŠ¸ë¦¬ë°ê³¼ í˜¼í•© ì–´ë ¤ì›€.                                                                          |
| **ê²°ê³¼**   | í¬ë¡¤ë§ â†’ (ìš”ì•½ ìŠ¤íŠ¸ë¦¬ë° âˆ¥ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±) â†’ ì™„ë£Œ íë¦„ìœ¼ë¡œ ì‚¬ìš©ì ëŒ€ê¸° ì‹œê°„ ìµœì†Œí™”                                                                                       |

### ADR-012: AudioService ë…ë¦½ í™˜ê²½ë³€ìˆ˜ ì„¤ì •

| í•­ëª©       | ë‚´ìš©                                                                                                                                                              |
| ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **ê²°ì •**   | AudioServiceë¥¼ ìœ„í•œ ë³„ë„ì˜ `AUDIO_SCRIPT_*` í™˜ê²½ë³€ìˆ˜ ê·¸ë£¹ ì‚¬ìš©                                                                                                    |
| **ì´ìœ **   | 1. SummaryServiceì™€ ë…ë¦½ì ì¸ LLM íŒŒë¼ë¯¸í„° ì„¤ì • <br> 2. ìŠ¤í¬ë¦½íŠ¸ ìƒì„±ì€ ì•½ê°„ì˜ ì°½ì˜ì„±ì´ í•„ìš” (temperature 0.5) <br> 3. í–¥í›„ ì„œë¹„ìŠ¤ë³„ ëª¨ë¸ ì„ íƒ ìœ ì—°ì„± í™•ë³´         |
| **ëŒ€ì•ˆ**   | ê¸°ì¡´ `GEMINI_*` í™˜ê²½ë³€ìˆ˜ ê³µìœ  - ì„œë¹„ìŠ¤ë³„ ì°¨ë³„í™” ë¶ˆê°€, A/B í…ŒìŠ¤íŠ¸ ì–´ë ¤ì›€                                                                                           |
| **ê²°ê³¼**   | `AUDIO_SCRIPT_MODEL`, `AUDIO_SCRIPT_TEMPERATURE` ë“± ë…ë¦½ ì„¤ì •ìœ¼ë¡œ ì„œë¹„ìŠ¤ë³„ íŠœë‹ ê°€ëŠ¥                                                                              |

### ADR-008: LangChain Structured Output ì„ íƒ

| í•­ëª©       | ë‚´ìš©                                                                                                                                                              |
| ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **ê²°ì •**   | LLM ì¶œë ¥ì— LangChainì˜ `with_structured_output()` ë©”ì„œë“œ ì‚¬ìš©                                                                                                     |
| **ì´ìœ **   | 1. Pydantic ëª¨ë¸ë¡œ íƒ€ì… ì•ˆì „í•œ ì¶œë ¥ ë³´ì¥ <br> 2. JSON íŒŒì‹± ë¡œì§ ë¶ˆí•„ìš” <br> 3. í•„ë“œ ê²€ì¦(min_length, max_length) ìë™ ì ìš© <br> 4. IDE ìë™ì™„ì„± ë° íƒ€ì… ì²´í¬ ì§€ì› |
| **ëŒ€ì•ˆ**   | ì§ì ‘ JSON íŒŒì‹± - í”„ë¡¬í”„íŠ¸ì— JSON í˜•ì‹ ëª…ì‹œ í›„ `json.loads()` ì‚¬ìš©. íƒ€ì… ì•ˆì „ì„± ì—†ê³  íŒŒì‹± ì—ëŸ¬ ì²˜ë¦¬ í•„ìš”.                                                          |
| **ìŠ¤í‚¤ë§ˆ** | `output_schemas/` ë””ë ‰í† ë¦¬ì— Pydantic ëª¨ë¸ ì •ì˜, LLM ì„œë¹„ìŠ¤ì—ì„œ importí•˜ì—¬ ì‚¬ìš©                                                                                   |

### ADR-009: í”„ë¡¬í”„íŠ¸ íŒŒì¼ ë¶„ë¦¬ ê´€ë¦¬

| í•­ëª©       | ë‚´ìš©                                                                                                                                       |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| **ê²°ì •**   | í”„ë¡¬í”„íŠ¸ë¥¼ `prompts/{version}/{name}.md` ë§ˆí¬ë‹¤ìš´ íŒŒì¼ë¡œ ë¶„ë¦¬ ê´€ë¦¬                                                                         |
| **ì´ìœ **   | 1. ë²„ì „ ê´€ë¦¬ ìš©ì´ (v1, v2 ë“±) <br> 2. A/B í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ <br> 3. ì½”ë“œ ë³€ê²½ ì—†ì´ í”„ë¡¬í”„íŠ¸ ìˆ˜ì • ê°€ëŠ¥ <br> 4. Git diffë¡œ í”„ë¡¬í”„íŠ¸ ë³€ê²½ ì´ë ¥ ì¶”ì  |
| **ë¡œë”**   | `app/services/prompt_loader.py`ì—ì„œ `@lru_cache` ì ìš©í•˜ì—¬ ìºì‹±                                                                             |
| **í¬ë§·íŒ…** | `{variable}` í˜•ì‹ì˜ í”Œë ˆì´ìŠ¤í™€ë” ì‚¬ìš©, Python `str.format()` í˜¸í™˜                                                                          |

### ADR-010: LangChain ChatGoogleGenerativeAI + Vertex AI ë°±ì—”ë“œ ì„ íƒ

| í•­ëª©         | ë‚´ìš©                                                                                                                                                                      |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **ê²°ì •**     | `langchain-google-genai`ì˜ `ChatGoogleGenerativeAI` í´ë˜ìŠ¤ ì‚¬ìš©, Vertex AI ë°±ì—”ë“œë¡œ ìë™ ì „í™˜                                                                             |
| **ì´ìœ **     | 1. ì„œë¹„ìŠ¤ ê³„ì •(ADC) ì¸ì¦ ì§€ì› <br> 2. `credentials` ë˜ëŠ” `project` íŒŒë¼ë¯¸í„° ì œê³µ ì‹œ Vertex AI ìë™ ì„ íƒ <br> 3. ë‹¨ì¼ íŒ¨í‚¤ì§€ë¡œ ë‘ ë°±ì—”ë“œ(Gemini API / Vertex AI) ëª¨ë‘ ì§€ì› |
| **ëŒ€ì•ˆ**     | `langchain-google-vertexai` - Vertex AI ì „ìš© íŒ¨í‚¤ì§€. ì¶”ê°€ ì˜ì¡´ì„± í•„ìš”.                                                                                                    |
| **ì¸ì¦**     | `~/readforme-key.json` ì„œë¹„ìŠ¤ ê³„ì • í‚¤ íŒŒì¼ ìë™ ê°ì§€, `GOOGLE_APPLICATION_CREDENTIALS` í™˜ê²½ë³€ìˆ˜ ì„¤ì •                                                                      |
| **í”„ë¡œì íŠ¸** | `gen-lang-client-0039052673` (Google Cloud í”„ë¡œì íŠ¸ ID)                                                                                                                   |

